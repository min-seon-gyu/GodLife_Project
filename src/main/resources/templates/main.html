<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <link
            th:href="@{/css/bootstrap.min.css}"
            href="../css/bootstrap.min.css"
            rel="stylesheet"
    />
    <style>
      .background {
        width: 100vw;

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .container {
        max-width: 1200px;
      }


    </style>
</head>
<body>

<div class="background">
    <div class="container">
        <div align="right" style="margin-top: 20px">
            <h5 style="display:inline; vertical-align: middle; font-weight : bold;" th:text="|ì•ˆë…•í•˜ì„¸ìš” ${name}ë‹˜!!|"></h5>
            <a href="/createUpdateMemberView" class="btn btn-secondary" role="button" >ë§ˆì´í˜ì´ì§€</a>
            <button type="button" class="btn btn-secondary" onclick=logout() >ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <br>

        <input type="text" id="datePicker" class="form-control" th:value="${day}" style="width:270px;">

        <h2 style="margin-top: 30px; font-weight : bold;" th:text="|${day} ì¼ì • (ìµœëŒ€ 5ê°œ)|"></h2>

        <th:block th:each="schedule : ${schedules}">
            <div style="margin-top: 20px">
                <div style="display:inline;">
                    <h4 th:if="${schedule.status == true}" th:text="|ğŸ˜¸ ${schedule.content}|" style="display:inline; vertical-align: middle;" ></h4>
                    <h4 th:if="${schedule.status == false}" th:text="|ğŸ˜¹ ${schedule.content}|" style="display:inline; vertical-align: middle;" ></h4>
                </div>
                <div style="margin-top: 10px">
                    <button th:if="${past == 'false'}" class="change-btn" th:attr="id=${schedule.id}" style="border-radius: 15px; font-weight : bold; background-color: #f5ebe0">
                        <p th:if="${schedule.status == true}" style="display:inline;" >ë¯¸ì™„</p>
                        <p th:if="${schedule.status == false}" style="display:inline;">ì™„ë£Œ</p>
                    </button>
                    <button th:if="${past == 'false'}" class="update-btn" th:attr="id=${schedule.id}, content=${schedule.content}" style="border-radius: 15px; font-weight : bold; background-color: #f5ebe0">ìˆ˜ì •</button>
                    <button th:if="${past == 'false'}" class="delete-btn" th:attr="id=${schedule.id}" style="border-radius: 15px; font-weight : bold; background-color: #f5ebe0">ì‚­ì œ</button>
                </div>
            </div>
        </th:block>


        <button th:if="${past == 'false'}" id="openAddModal" style="font-weight : bold; background: #e3d5ca; border-radius: 15px; margin-top: 30px" >ì¶”ê°€í•˜ê¸°</button>

        <div id="addModal" class="modal">
            <div class="modal-content">
                <label>ì¼ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœì†Œ 2ì, ìµœëŒ€ 30ì ì…ë‹ˆë‹¤.)</label>
                <input type="text" id="addContent" style="margin-top: 10px" class="form-control" maxlength="30"
                       minlength="2">
                <div align="right" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick=add()>ì¶”ê°€</button>
                    <button type="button" class="btn btn-secondary" id="close-add-btn">ë‹«ê¸°</button>
                </div>
            </div>
        </div>

        <div id="updateModal" class="modal">
            <div class="modal-content">
                <label>ì¼ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìµœì†Œ 2ì, ìµœëŒ€ 30ì ì…ë‹ˆë‹¤.)</label>
                <input type="text" id="updateContent" style="margin-top: 10px" class="form-control" maxlength="30"
                       minlength="2">
                <div align="right" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick=update()>ìˆ˜ì •</button>
                    <button type="button" class="btn btn-secondary" id="close-update-btn">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>
    $('#datePicker')
        .datepicker({
            changeYear: true,
            changeMonth: true,
            showOtherMonths: true,
            showButtonPanel: true,
            dateFormat: 'yy-mm-dd',
            minDate: '2000-01-01',
            maxDate: '2099-12-31',
            yearRange: '2000:2099',
            closeText: 'ë‹«ê¸°',
            currentText: 'ì˜¤ëŠ˜',
            prevText: 'ì´ì „ ë‹¬',
            nextText: 'ë‹¤ìŒ ë‹¬',
            monthNames: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'],
            monthNamesShort: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'],
            dayNames: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
            dayNamesShort: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
            dayNamesMin: ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '],
            showMonthAfterYear: true,
            yearSuffix: 'ë…„',
            onSelect: function(dateText, inst) {
                var day = $(this).val();
                var year = day.substr(0, 4);
                var month = day.substr(5, 2);
                var date = day.substr(8, 2);
                location.replace(`/schedule/${year}/${month}/${date}`)
            }
        });

    function logout() {
        fetch("/logout", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
        })
        .then(res => {
            if(res.status === 200){
               window.location.href=window.location.href
            }else{
               alert("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        });
   }

   function add() {
       var date = document.getElementById("datePicker").value;
       var content = document.getElementById("addContent").value;
       fetch("/schedule", {
           method: "POST",
           headers: {
               "Content-Type": "application/json"
           },
           body: JSON.stringify({
                date: date,
                content: content
            })
       })
       .then(res => {
           if(res.status === 400){
               alert("ì…ë ¥í•˜ì‹  ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
           }else if(res.status === 500){
               alert("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
           }else if(res.status === 200){
               window.location.href=window.location.href
           }
       });
   }

   function update() {
       var id = document.getElementById("updateContent").getAttribute("content_id");
       var content = document.getElementById("updateContent").value;

       fetch("/schedule", {
           method: "PATCH",
           headers: {
               "Content-Type": "application/json"
           },
           body: JSON.stringify({
                id: id,
                content: content
            })
       })
       .then(res => {
           if(res.status === 400){
               alert("ì…ë ¥í•˜ì‹  ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
           }else if(res.status === 500){
               alert("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
           }else if(res.status === 200){
               window.location.href=window.location.href
           }
       });
   }

document.addEventListener("DOMContentLoaded", function() {

  var changeButtons = document.querySelectorAll(".change-btn");

  changeButtons.forEach(function(button) {
    button.addEventListener("click", function() {
      var id = button.getAttribute("id");
      fetch("/schedule/changeStatus", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          id: id
        })
      })
      .then(res => {
        if(res.status === 200){
          window.location.href=window.location.href
        }else{
          alert("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      });
    });
  });

  var deleteButtons = document.querySelectorAll(".delete-btn");

  deleteButtons.forEach(function(button) {
    button.addEventListener("click", function() {
      var id = button.getAttribute("id");
      var date = document.getElementById("datePicker").value;
      fetch("/schedule", {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          id: id,
          date: date
        })
      })
      .then(res => {
        if(res.status === 200){
          window.location.href=window.location.href
        }else{
          alert("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }
      });
    });
  });

  var updateButtons = document.querySelectorAll(".update-btn");

  updateButtons.forEach(function(button) {
    button.addEventListener("click", function() {
      var content = button.getAttribute("content");
      var id = button.getAttribute("id");
      var updateContent = document.getElementById("updateContent");
      updateModal.style.display = "block";
      updateContent.value = content;
      updateContent.setAttribute("content_id", id);
    });
  });
});

    var openAddModalBtn = document.getElementById("openAddModal");

    var addModal = document.getElementById("addModal");
    var updateModal = document.getElementById("updateModal");

    var closeAddModalBtn = document.getElementById("close-add-btn");
    var closeUpdateModalBtn = document.getElementById("close-update-btn");

    var addContent = document.getElementById("addContent");


    openAddModalBtn.onclick = function() {
        addModal.style.display = "block";
    }

    closeAddModalBtn.onclick = function() {
        addModal.style.display = "none";
        addContent.value = "";
    }

    closeUpdateModalBtn.onclick = function() {
        updateModal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == addModal) {
            addModal.style.display = "none";
            addContent.value = "";
        }
        if (event.target == updateModal) {
            updateModal.style.display = "none";
        }
    }
</script>
</body>
</html>